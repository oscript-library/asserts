&Тест
Процедура ТестДетализацииОшибокВМассивах() Экспорт
	
	// Тест различия типов
	Попытка
		Ожидаем.Что("строка").РавноМассиву(Новый Массив);
		ВызватьИсключение "Исключение должно было возникнуть";
	Исключение
		СообщениеОбОшибке = ОписаниеОшибки();
		Ожидаем.Что(СообщениеОбОшибке).Содержит("ожидался массив, но получен");
	КонецПопытки;
	
	// Тест различия количества элементов
	Массив1 = Новый Массив;
	Массив1.Добавить(1);
	Массив1.Добавить(2);
	
	Массив2 = Новый Массив;
	Массив2.Добавить(1);
	
	Попытка
		Ожидаем.Что(Массив1).РавноМассиву(Массив2);
		ВызватьИсключение "Исключение должно было возникнуть";
	Исключение
		СообщениеОбОшибке = ОписаниеОшибки();
		Ожидаем.Что(СообщениеОбОшибке).Содержит("разное количество элементов");
		Ожидаем.Что(СообщениеОбОшибке).Содержит("ожидалось 1, получено 2");
	КонецПопытки;
	
	// Тест различия в конкретном элементе массива
	Массив1 = Новый Массив;
	Массив1.Добавить(1);
	Массив1.Добавить(999); // Различие здесь
	Массив1.Добавить(3);
	
	Массив2 = Новый Массив;
	Массив2.Добавить(1);
	Массив2.Добавить(2); // Ожидается 2
	Массив2.Добавить(3);
	
	Попытка
		Ожидаем.Что(Массив1).РавноМассиву(Массив2);
		ВызватьИсключение "Исключение должно было возникнуть";
	Исключение
		СообщениеОбОшибке = ОписаниеОшибки();
		Ожидаем.Что(СообщениеОбОшибке).Содержит("[1]"); // Индекс элемента
		Ожидаем.Что(СообщениеОбОшибке).Содержит("ожидалось 2, получено 999");
	КонецПопытки;
	
КонецПроцедуры

&Тест
Процедура ТестДетализацииОшибокВСтруктурах() Экспорт
	
	// Тест различия типов
	Попытка
		Ожидаем.Что("строка").РавноСтруктуреИлиСоответствию(Новый Структура);
		ВызватьИсключение "Исключение должно было возникнуть";
	Исключение
		СообщениеОбОшибке = ОписаниеОшибки();
		Ожидаем.Что(СообщениеОбОшибке).Содержит("ожидался Structure, получен String");
	КонецПопытки;
	
	// Тест отсутствующего ключа
	Структура1 = Новый Структура("Ключ1, Ключ2", 1, 2);
	Структура2 = Новый Структура("Ключ1, Ключ3", 1, 3); // Ключ2 отсутствует, есть Ключ3
	
	Попытка
		Ожидаем.Что(Структура1).РавноСтруктуреИлиСоответствию(Структура2);
		ВызватьИсключение "Исключение должно было возникнуть";
	Исключение
		СообщениеОбОшибке = ОписаниеОшибки();
		// Может быть либо отсутствие Ключ3, либо лишний Ключ2
		Условие = Найти(СообщениеОбОшибке, ".Ключ3") > 0 Или Найти(СообщениеОбОшибке, ".Ключ2") > 0;
		Ожидаем.Что(Условие).Равно(Истина);
	КонецПопытки;
	
	// Тест различия в значении ключа
	Структура1 = Новый Структура("Поле1, Поле2", "значение1", 999); // Различие в Поле2
	Структура2 = Новый Структура("Поле1, Поле2", "значение1", 555); // Ожидается 555
	
	Попытка
		Ожидаем.Что(Структура1).РавноСтруктуреИлиСоответствию(Структура2);
		ВызватьИсключение "Исключение должно было возникнуть";
	Исключение
		СообщениеОбОшибке = ОписаниеОшибки();
		Ожидаем.Что(СообщениеОбОшибке).Содержит(".Поле2"); // Ключ элемента
		Ожидаем.Что(СообщениеОбОшибке).Содержит("ожидалось 555, получено 999");
	КонецПопытки;
	
КонецПроцедуры

&Тест
Процедура ТестДетализацииОшибокВложенныхСтруктур() Экспорт
	
	// Тест вложенных структур
	ВнутренняяСтруктура1 = Новый Структура("ВнутреннийКлюч", 999); // Различие здесь
	ВнутренняяСтруктура2 = Новый Структура("ВнутреннийКлюч", 123); // Ожидается 123
	
	ВнешняяСтруктура1 = Новый Структура("ВнешнийКлюч", ВнутренняяСтруктура1);
	ВнешняяСтруктура2 = Новый Структура("ВнешнийКлюч", ВнутренняяСтруктура2);
	
	Попытка
		Ожидаем.Что(ВнешняяСтруктура1).РавноСтруктуреИлиСоответствию(ВнешняяСтруктура2);
		ВызватьИсключение "Исключение должно было возникнуть";
	Исключение
		СообщениеОбОшибке = ОписаниеОшибки();
		Ожидаем.Что(СообщениеОбОшибке).Содержит(".ВнешнийКлюч.ВнутреннийКлюч"); // Полный путь
		Ожидаем.Что(СообщениеОбОшибке).Содержит("ожидалось 123, получено 999");
	КонецПопытки;
	
КонецПроцедуры

&Тест
Процедура ТестДетализацииОшибокВложенныхМассивов() Экспорт
	
	// Тест массива массивов
	ВнутреннийМассив1 = Новый Массив;
	ВнутреннийМассив1.Добавить(1);
	ВнутреннийМассив1.Добавить(999); // Различие здесь
	
	ВнутреннийМассив2 = Новый Массив;
	ВнутреннийМассив2.Добавить(1);
	ВнутреннийМассив2.Добавить(2); // Ожидается 2
	
	ВнешнийМассив1 = Новый Массив;
	ВнешнийМассив1.Добавить("строка");
	ВнешнийМассив1.Добавить(ВнутреннийМассив1);
	
	ВнешнийМассив2 = Новый Массив;
	ВнешнийМассив2.Добавить("строка");
	ВнешнийМассив2.Добавить(ВнутреннийМассив2);
	
	Попытка
		Ожидаем.Что(ВнешнийМассив1).РавноМассиву(ВнешнийМассив2);
		ВызватьИсключение "Исключение должно было возникнуть";
	Исключение
		СообщениеОбОшибке = ОписаниеОшибки();
		Ожидаем.Что(СообщениеОбОшибке).Содержит("[1][1]"); // Полный путь с индексами
		Ожидаем.Что(СообщениеОбОшибке).Содержит("ожидалось 2, получено 999");
	КонецПопытки;
	
КонецПроцедуры

&Тест
Процедура ТестДетализацииОшибокСмешанныхТипов() Экспорт
	
	// Тест структуры с массивом
	МассивВСтруктуре1 = Новый Массив;
	МассивВСтруктуре1.Добавить("элемент1");
	МассивВСтруктуре1.Добавить(999); // Различие здесь
	
	МассивВСтруктуре2 = Новый Массив;
	МассивВСтруктуре2.Добавить("элемент1");
	МассивВСтруктуре2.Добавить(555); // Ожидается 555
	
	Структура1 = Новый Структура("Массив", МассивВСтруктуре1);
	Структура2 = Новый Структура("Массив", МассивВСтруктуре2);
	
	Попытка
		Ожидаем.Что(Структура1).РавноСтруктуреИлиСоответствию(Структура2);
		ВызватьИсключение "Исключение должно было возникнуть";
	Исключение
		СообщениеОбОшибке = ОписаниеОшибки();
		Ожидаем.Что(СообщениеОбОшибке).Содержит(".Массив[1]"); // Путь структура -> массив -> индекс
		Ожидаем.Что(СообщениеОбОшибке).Содержит("ожидалось 555, получено 999");
	КонецПопытки;
	
КонецПроцедуры

&Тест
Процедура ТестДетализацииОшибокВСоответствиях() Экспорт
	
	// Тест различия в значении ключа соответствия
	Соответствие1 = Новый Соответствие;
	Соответствие1.Вставить("Ключ1", "значение1");
	Соответствие1.Вставить("Ключ2", 999); // Различие здесь
	
	Соответствие2 = Новый Соответствие;
	Соответствие2.Вставить("Ключ1", "значение1");
	Соответствие2.Вставить("Ключ2", 777); // Ожидается 777
	
	Попытка
		Ожидаем.Что(Соответствие1).РавноСтруктуреИлиСоответствию(Соответствие2);
		ВызватьИсключение "Исключение должно было возникнуть";
	Исключение
		СообщениеОбОшибке = ОписаниеОшибки();
		Ожидаем.Что(СообщениеОбОшибке).Содержит(".Ключ2"); // Ключ элемента
		Ожидаем.Что(СообщениеОбОшибке).Содержит("ожидалось 777, получено 999");
	КонецПопытки;
	
КонецПроцедуры


